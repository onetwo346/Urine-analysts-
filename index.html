<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Urine Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
        .crosshair { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            width: 100px; 
            height: 100px; 
            border: 2px solid #fff; 
            border-radius: 50%; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-black">
    <!-- Start Screen -->
    <div id="startScreen" class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-br from-blue-900 to-teal-600">
        <h1 class="text-4xl font-bold text-white mb-2">Live Urine Analyzer</h1>
        <p class="text-blue-100 mb-8 text-center">Real-time color analysis with instant results</p>
        <button onclick="startAnalysis()" class="bg-white text-blue-900 px-8 py-3 rounded-full font-semibold hover:bg-blue-50 transition">Start Live Analysis</button>
    </div>

```
<!-- Camera Screen -->
<div id="cameraScreen" class="hidden relative min-h-screen">
    <video id="video" class="w-full h-screen object-cover" autoplay playsinline></video>
    <canvas id="canvas" class="hidden"></canvas>
    
    <!-- Overlay UI -->
    <div class="overlay">
        <!-- Crosshair -->
        <div class="crosshair pulse"></div>
        
        <!-- Top Status Bar -->
        <div class="absolute top-4 left-4 right-4 flex justify-between items-center">
            <div class="bg-black bg-opacity-50 text-white px-3 py-1 rounded-full text-sm">
                ðŸ”´ LIVE ANALYSIS
            </div>
            <button onclick="toggleReports()" class="bg-blue-500 text-white px-4 py-2 rounded-full text-sm hover:bg-blue-600 transition pointer-events-auto">
                Reports
            </button>
        </div>

        <!-- Live Results Panel -->
        <div class="absolute bottom-4 left-4 right-4">
            <div class="bg-black bg-opacity-80 text-white rounded-2xl p-4 backdrop-blur">
                <div class="flex items-center gap-4 mb-3">
                    <div id="colorPreview" class="w-12 h-12 rounded-full border-2 border-white"></div>
                    <div>
                        <div id="colorName" class="font-bold text-lg">Analyzing...</div>
                        <div id="healthStatus" class="text-sm opacity-80">Move camera to sample</div>
                    </div>
                </div>
                <div id="advice" class="text-sm bg-blue-500 bg-opacity-20 rounded-lg p-2 mb-3">
                    Point camera at urine sample in good lighting
                </div>
                <div class="flex gap-2">
                    <button onclick="saveResult()" class="flex-1 bg-green-500 text-white py-2 rounded-lg text-sm hover:bg-green-600 transition pointer-events-auto">
                        ðŸ’¾ Save Result
                    </button>
                    <button onclick="resetApp()" class="bg-gray-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-gray-600 transition pointer-events-auto">
                        âœ•
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Reports Screen -->
<div id="reportsScreen" class="hidden min-h-screen bg-gray-100 p-4">
    <div class="max-w-md mx-auto">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">Analysis Reports</h2>
            <button onclick="toggleReports()" class="text-blue-500 hover:text-blue-600">âœ• Close</button>
        </div>
        <div id="reportsList" class="space-y-3">
            <div class="text-center text-gray-500 py-8">No reports saved yet</div>
        </div>
        <button onclick="exportReports()" class="w-full bg-blue-500 text-white py-3 rounded-lg mt-4 hover:bg-blue-600 transition">
            ðŸ“¤ Export All Reports
        </button>
    </div>
</div>

<script>
    const colorMap = [
        { name: "Clear", rgb: [240, 240, 240], status: "Overhydrated", advice: "Reduce fluid intake slightly", color: "#f0f0f0" },
        { name: "Pale Yellow", rgb: [255, 245, 157], status: "Normal", advice: "Perfect hydration level!", color: "#fff59d" },
        { name: "Yellow", rgb: [255, 235, 59], status: "Normal", advice: "Good hydration level", color: "#ffeb3b" },
        { name: "Dark Yellow", rgb: [255, 193, 7], status: "Mild Dehydration", advice: "Drink more water", color: "#ffc107" },
        { name: "Amber", rgb: [245, 124, 0], status: "Dehydrated", advice: "Increase water intake now", color: "#f57c00" },
        { name: "Brown", rgb: [121, 85, 72], status: "Severe Issue", advice: "See doctor immediately", color: "#795548" },
        { name: "Red/Pink", rgb: [244, 67, 54], status: "Blood Present", advice: "Consult doctor urgently", color: "#f44336" },
        { name: "Blue/Green", rgb: [0, 150, 136], status: "Unusual", advice: "Medical consultation needed", color: "#009688" }
    ];

    let stream = null;
    let isAnalyzing = false;
    let reports = JSON.parse(localStorage.getItem('urineReports') || '[]');

    async function startAnalysis() {
        document.getElementById('startScreen').classList.add('hidden');
        document.getElementById('cameraScreen').classList.remove('hidden');
        
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment", width: 1280, height: 720 } 
            });
            document.getElementById('video').srcObject = stream;
            startRealTimeAnalysis();
        } catch (err) {
            alert("Camera access needed for analysis");
            resetApp();
        }
    }

    function startRealTimeAnalysis() {
        if (isAnalyzing) return;
        isAnalyzing = true;
        
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        function analyze() {
            if (!isAnalyzing) return;
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            // Sample center area (crosshair region)
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const sampleSize = 50;
            
            const imageData = ctx.getImageData(
                centerX - sampleSize/2, 
                centerY - sampleSize/2, 
                sampleSize, 
                sampleSize
            ).data;
            
            let r = 0, g = 0, b = 0, count = 0;
            for (let i = 0; i < imageData.length; i += 4) {
                r += imageData[i];
                g += imageData[i + 1];
                b += imageData[i + 2];
                count++;
            }
            
            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);
            
            const result = findClosestColor(r, g, b);
            updateUI(result, r, g, b);
            
            requestAnimationFrame(analyze);
        }
        
        video.addEventListener('loadedmetadata', () => {
            analyze();
        });
    }

    function findClosestColor(r, g, b) {
        let closest = colorMap[0];
        let minDistance = Infinity;
        
        colorMap.forEach(color => {
            const distance = Math.sqrt(
                Math.pow(r - color.rgb[0], 2) +
                Math.pow(g - color.rgb[1], 2) +
                Math.pow(b - color.rgb[2], 2)
            );
            if (distance < minDistance) {
                minDistance = distance;
                closest = color;
            }
        });
        
        return { ...closest, detectedRgb: [r, g, b] };
    }

    function updateUI(result, r, g, b) {
        document.getElementById('colorPreview').style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
        document.getElementById('colorName').textContent = result.name;
        document.getElementById('healthStatus').textContent = result.status;
        document.getElementById('advice').textContent = result.advice;
        
        // Color-code the advice based on urgency
        const adviceEl = document.getElementById('advice');
        if (result.status.includes('Severe') || result.status.includes('Blood')) {
            adviceEl.className = 'text-sm bg-red-500 bg-opacity-20 rounded-lg p-2 mb-3';
        } else if (result.status.includes('Dehydrat')) {
            adviceEl.className = 'text-sm bg-orange-500 bg-opacity-20 rounded-lg p-2 mb-3';
        } else {
            adviceEl.className = 'text-sm bg-green-500 bg-opacity-20 rounded-lg p-2 mb-3';
        }
    }

    function saveResult() {
        const result = {
            timestamp: new Date().toISOString(),
            color: document.getElementById('colorName').textContent,
            status: document.getElementById('healthStatus').textContent,
            advice: document.getElementById('advice').textContent,
            rgb: document.getElementById('colorPreview').style.backgroundColor
        };
        
        reports.unshift(result);
        localStorage.setItem('urineReports', JSON.stringify(reports));
        
        // Show confirmation
        const btn = event.target;
        const original = btn.textContent;
        btn.textContent = 'âœ… Saved!';
        btn.classList.add('bg-green-600');
        setTimeout(() => {
            btn.textContent = original;
            btn.classList.remove('bg-green-600');
        }, 1500);
    }

    function toggleReports() {
        const camera = document.getElementById('cameraScreen');
        const reports = document.getElementById('reportsScreen');
        
        if (reports.classList.contains('hidden')) {
            camera.classList.add('hidden');
            reports.classList.remove('hidden');
            displayReports();
        } else {
            reports.classList.add('hidden');
            camera.classList.remove('hidden');
        }
    }

    function displayReports() {
        const container = document.getElementById('reportsList');
        if (reports.length === 0) {
            container.innerHTML = '<div class="text-center text-gray-500 py-8">No reports saved yet</div>';
            return;
        }
        
        container.innerHTML = reports.map(report => `
            <div class="bg-white rounded-lg p-4 shadow">
                <div class="flex items-center gap-3 mb-2">
                    <div class="w-8 h-8 rounded-full border-2 border-gray-300" style="background-color: ${report.rgb}"></div>
                    <div>
                        <div class="font-semibold">${report.color}</div>
                        <div class="text-sm text-gray-500">${new Date(report.timestamp).toLocaleString()}</div>
                    </div>
                </div>
                <div class="text-sm">
                    <div class="mb-1"><strong>Status:</strong> ${report.status}</div>
                    <div><strong>Advice:</strong> ${report.advice}</div>
                </div>
            </div>
        `).join('');
    }

    function exportReports() {
        if (reports.length === 0) {
            alert('No reports to export');
            return;
        }
        
        const csv = [
            'Timestamp,Color,Status,Advice',
            ...reports.map(r => `"${r.timestamp}","${r.color}","${r.status}","${r.advice}"`)
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `urine-analysis-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        URL.revokeObjectURL(url);
    }

    function resetApp() {
        isAnalyzing = false;
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        document.getElementById('cameraScreen').classList.add('hidden');
        document.getElementById('reportsScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
    }
</script>
```

</body>
</html>
